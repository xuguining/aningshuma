<template>
<!-- 父路由 底部导航栏 -->
  <div class="home">
    <div class="footer_nav">
      <van-tabbar
        v-model="active"
        :active-color="icon.active"
        :inactive-color="icon.inactive"
        route
      >
        <van-tabbar-item  to="/homepage">
          <span>首页</span>
          <template #icon="props">
            <svg
              t="1652181713746"
              class="icon"
              viewBox="0 0 1025 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="2319"
              width="24"
              height="24"
            >
              <path
                d="M779 1024h-184v-196.4c0-14.4-11.6-26-26-26h-93.2c-14.4 0-26 11.8-26 26V1024h-198.8c-54.8 0-99.4-44.6-99.4-99.4V600.2l-112.2-35-9-9c-26.6-26.6-26.6-69.6 0-96.2L470 20.4c12.8-12.8 29.8-20 48-20s35.2 7 48 20l439.6 439.8c12.8 12.8 20 30 19.8 48 0 18.2-7.2 35.2-20 48l-9 9-118.4 35.2v324.2c0.2 54.8-44.2 99.4-99 99.4z"
                :fill="props.active ? icon.active : icon.inactive"
                p-id="2320"
              ></path>
            </svg>
          </template>
        </van-tabbar-item>
        <van-tabbar-item  to="/classcation">
        <span>分类</span>
          <template #icon="props">
            <svg
              t="1652181816468"
              class="icon"
              viewBox="-50 -5 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="3430"
              width="35"
              height="24"
            >
              <path
                d="M640.8 1023.2c-49.6 0-92.8-64-92.8-116.8V641.6c0-51.2 41.6-92.8 92.8-92.8h289.6c51.2 0 92.8 41.6 92.8 92.8v288.8c0 51.2-41.6 92.8-92.8 92.8H640.8z m1.6-426.4c-26.4 0-48 21.6-48 48v285.6c0 26.4 21.6 48 48 48H928c26.4 0 48-21.6 48-48V644.8c0-26.4-21.6-48-48-48H642.4z m-548.8 426.4c-49.6 0-92.8-64-92.8-116.8V641.6c0-51.2 41.6-92.8 92.8-92.8h289.6c51.2 0 92.8 41.6 92.8 92.8v288.8c0 51.2-41.6 92.8-92.8 92.8H93.6z m1.6-426.4c-26.4 0-48 21.6-48 48v285.6c0 26.4 21.6 48 48 48h285.6c26.4 0 48-21.6 48-48V644.8c0-26.4-21.6-48-48-48H95.2z m545.6-120.8c-49.6 0-92.8-64-92.8-116.8V94.4C548 43.2 589.6 1.6 640.8 1.6h289.6c51.2 0 92.8 41.6 92.8 92.8v288.8c0 51.2-41.6 92.8-92.8 92.8H640.8z m1.6-426.4c-26.4 0-48 21.6-48 48v285.6c0 26.4 21.6 48 48 48H928c26.4 0 48-21.6 48-48V97.6c0-26.4-21.6-48-48-48H642.4zM93.6 476C44 476 0.8 412 0.8 359.2V94.4C0.8 43.2 42.4 1.6 93.6 1.6h289.6c51.2 0 92.8 41.6 92.8 92.8v288.8c0 51.2-41.6 92.8-92.8 92.8H93.6z m1.6-426.4c-26.4 0-48 21.6-48 48v285.6c0 26.4 21.6 48 48 48h285.6c26.4 0 48-21.6 48-48V97.6c0-26.4-21.6-48-48-48H95.2z"
                :fill="props.active ? icon.active : icon.inactive"
                p-id="3431"
              ></path>
            </svg>
          </template>
        </van-tabbar-item>
        <!-- 判断一下购物车小徽标是不是0 -->
        <van-tabbar-item v-if="shopcarNum==0"   to="/shopcard" >
          <span>购物车</span>
          <template #icon="props">
            <svg
              t="1652181907844"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="4412"
              width="24"
              height="24"
            >
              <path
                d="M352.456912 832.032253c-35.434907 0-63.989249 28.554342-63.989249 63.989249 0 35.434907 28.554342 63.989249 63.989249 63.989249s63.989249-28.554342 63.989249-63.989249C416.446162 860.586595 387.891819 832.032253 352.456912 832.032253L352.456912 832.032253z"
                p-id="4413"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
              <path
                d="M800.55367 832.032253c-35.434907 0-63.989249 28.554342-63.989249 63.989249 0 35.434907 28.554342 63.989249 63.989249 63.989249s63.989249-28.554342 63.989249-63.989249C864.54292 860.586595 835.816563 832.032253 800.55367 832.032253L800.55367 832.032253z"
                p-id="4414"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
              <path
                d="M864.026877 800.037628 344.200235 800.037628c-46.099782 0-86.695112-36.466991-92.199563-83.082815l-54.356459-382.043339L166.853687 156.360826c-1.892155-15.653284-16.169326-28.382328-29.930455-28.382328L95.983874 127.978498c-17.717453 0-31.994625-14.277171-31.994625-31.994625s14.277171-31.994625 31.994625-31.994625l40.767344 0c46.615824 0 87.727196 36.466991 93.403662 83.082815l30.790526 177.86259L315.473879 708.698135c1.720141 14.793214 15.309256 27.350244 28.726356 27.350244l519.826642 0c17.717453 0 31.994625 14.277171 31.994625 31.994625S881.744331 800.037628 864.026877 800.037628z"
                p-id="4415"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
              <path
                d="M384.279523 672.05913c-16.685369 0-30.618512-12.729044-31.82261-29.586427-1.376113-17.545439 11.868974-33.026709 29.586427-34.230808l434.163615-31.994625c15.997312-0.172014 29.414413-12.55703 31.134554-26.834201l50.400134-288.295649c1.204099-10.664875-1.720141-22.533848-8.084663-29.758441-4.128339-4.644381-9.288762-7.052579-15.309256-7.052579L319.946246 224.3064c-17.717453 0-31.994625-14.277171-31.994625-31.994625S302.400806 159.973123 319.946246 159.973123l554.05745 0c24.426004 0 46.959852 10.148833 63.301193 28.554342 18.749538 21.157736 27.178229 50.744163 23.565933 81.706703l-50.400134 288.467663c-5.504452 44.895683-45.927768 81.362674-92.027549 81.362674l-431.755417 31.82261C385.82765 671.887116 384.967579 672.05913 384.279523 672.05913z"
                p-id="4416"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
            </svg> </template
        ></van-tabbar-item>
        <!-- 购物车小徽标不是0时 -->
        <van-tabbar-item v-else  to="/shopcard" :badge="shopcarNum">
          <span>购物车</span>
          <template #icon="props">
            <svg
              t="1652181907844"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="4412"
              width="24"
              height="24"
            >
              <path
                d="M352.456912 832.032253c-35.434907 0-63.989249 28.554342-63.989249 63.989249 0 35.434907 28.554342 63.989249 63.989249 63.989249s63.989249-28.554342 63.989249-63.989249C416.446162 860.586595 387.891819 832.032253 352.456912 832.032253L352.456912 832.032253z"
                p-id="4413"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
              <path
                d="M800.55367 832.032253c-35.434907 0-63.989249 28.554342-63.989249 63.989249 0 35.434907 28.554342 63.989249 63.989249 63.989249s63.989249-28.554342 63.989249-63.989249C864.54292 860.586595 835.816563 832.032253 800.55367 832.032253L800.55367 832.032253z"
                p-id="4414"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
              <path
                d="M864.026877 800.037628 344.200235 800.037628c-46.099782 0-86.695112-36.466991-92.199563-83.082815l-54.356459-382.043339L166.853687 156.360826c-1.892155-15.653284-16.169326-28.382328-29.930455-28.382328L95.983874 127.978498c-17.717453 0-31.994625-14.277171-31.994625-31.994625s14.277171-31.994625 31.994625-31.994625l40.767344 0c46.615824 0 87.727196 36.466991 93.403662 83.082815l30.790526 177.86259L315.473879 708.698135c1.720141 14.793214 15.309256 27.350244 28.726356 27.350244l519.826642 0c17.717453 0 31.994625 14.277171 31.994625 31.994625S881.744331 800.037628 864.026877 800.037628z"
                p-id="4415"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
              <path
                d="M384.279523 672.05913c-16.685369 0-30.618512-12.729044-31.82261-29.586427-1.376113-17.545439 11.868974-33.026709 29.586427-34.230808l434.163615-31.994625c15.997312-0.172014 29.414413-12.55703 31.134554-26.834201l50.400134-288.295649c1.204099-10.664875-1.720141-22.533848-8.084663-29.758441-4.128339-4.644381-9.288762-7.052579-15.309256-7.052579L319.946246 224.3064c-17.717453 0-31.994625-14.277171-31.994625-31.994625S302.400806 159.973123 319.946246 159.973123l554.05745 0c24.426004 0 46.959852 10.148833 63.301193 28.554342 18.749538 21.157736 27.178229 50.744163 23.565933 81.706703l-50.400134 288.467663c-5.504452 44.895683-45.927768 81.362674-92.027549 81.362674l-431.755417 31.82261C385.82765 671.887116 384.967579 672.05913 384.279523 672.05913z"
                p-id="4416"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
            </svg> </template
        ></van-tabbar-item>
        <van-tabbar-item to="/myview">
          <span>我的</span>
          <template #icon="props">
            <svg
              t="1652182012627"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="5480"
              width="24"
              height="24"
            >
              <path
                d="M159.973123 928.016126c-10.664875 0-20.985721-5.332437-27.178229-14.965228-9.460776-14.965228-4.988409-34.74685 9.976818-44.207626 5.504452-3.440282 136.579204-85.491013 240.647741-90.651436l0.516042 0L383.935495 760.302369c-120.409877-49.884092-199.708382-175.626407-199.708382-320.462288 0-189.55955 145.867966-343.856207 325.278683-343.856207s325.278683 154.124643 325.278683 343.856207c0 144.663867-75.858223 267.137914-195.064001 318.398119l0 20.297665c104.756593 9.460776 234.799261 86.695112 240.475727 89.96338 15.137242 9.116748 20.125651 28.726356 11.008903 43.863598-9.116748 15.137242-28.726356 20.125651-43.863598 11.008903-1.204099-0.688056-126.258357-74.826138-214.157568-81.362674l-25.458088 0c-17.717453 0-31.994625-14.277171-31.994625-31.994625l0-73.966068c0-13.589115 8.600706-25.802117 21.673778-30.274483 105.44465-36.294977 173.390223-140.707542 173.390223-266.277843C770.967243 285.543423 653.825634 159.973123 509.67781 159.973123c-144.147825 0-261.289434 125.570301-261.289434 279.866958 0 125.742315 71.385856 233.251134 177.518562 267.653956 13.245087 4.300353 22.18982 16.513355 22.18982 30.446498l0 72.245926c0 17.717453-14.277171 31.994625-31.994625 31.994625l-30.96254 0c-85.835041 4.300353-206.760961 79.986561-207.96506 80.846632C171.842096 926.295985 165.821603 928.016126 159.973123 928.016126z"
                p-id="5481"
                :fill="props.active ? icon.active : icon.inactive"
              ></path>
            </svg> </template
        ></van-tabbar-item>
      </van-tabbar>
    </div>
    <router-view></router-view>
  </div>
</template>

<script>
import Vue from "vue";
import { Tabbar, TabbarItem } from "vant";
    // 试试这个模块辅助函数帮手
// import { createNamespacedHelpers } from "vuex";
// const userNs = createNamespacedHelpers("user");
Vue.use(Tabbar);
Vue.use(TabbarItem);


export default {
  name: "HomeView",
  data() {
    return {
      active: 0,//vant默认选中
      icon: {
        active: "rgb(80,180,80)",//选择颜色
        inactive: "#cdcdcd",//未选择颜色
      },
      data:'',//shopobj-data的数据
      shopcarNum:0,//徽标的数据
    }
  },
  computed:{
    // 展示一下购物车数量小徽标
      // shopcarNum(){
      //   let data=localStorage.getItem('shopobj-data');
      //   return JSON.parse(data).length;
      // }
  // 尝试失败
      // shopcarNum:{
      //     get(){
      //       return JSON.parse(this.data).length;
      //     },
      //     set(value){
      //       console.log("czy11",value)
      //       return JSON.parse(this.data).length;
      //     }
      // }
  },
  watch:{
    data:{
        // immediate:true,
        deep:true,
        handler(value){
          // console.log('czyyyyyy',value);
          // console.log('czyyyyyy',JSON.parse(value).length);
          this.shopcarNum=JSON.parse(value).length;

        }
    },


  },
  methods:{
    // 全局事件总线回调 收个值来改徽标 
    deleteNum(value){
      // console.log("czy11",value);
      this.data=JSON.stringify(value);
      // console.log("czy22",this.data);
    }
  },
  // computed: {
  //   ...userNs.mapState(["token"]),
  // },
  // methods:{
  //   // 没登录就是登录页面
  //   goOr(){
  //     // console.log("token1",this.token,"11");
  //     if(this.token == ""){
  //       // console.log('进来了')
  //       // this.$router.push({name:"Login"})
  //       this.$router.push({ name: "Login" });
  //     }else{
  //       // console.log("czyyy")
  //       this.$router.push({name:"ShopCard"})
  //     }
  //   }
  // }
  // created(){
  //   console.log("czy1",localStorage.getItem('shopobj-data').length);
  //   console.log("czy1",localStorage.getItem('shopobj-data'));
  // }

//本来想着深度侦听一下data  但后面发现底部导航栏一直没被销毁 只是被子组件盖着了 所以 created覆盖不了 等以后有时候用全局事件总线 处理一下这个购物车删除内容时的小徽标更新问题
  created(){
    this.data=localStorage.getItem('shopobj-data');
    
    // console.log("czy",this.data)
  },
  mounted(){
    this.$bus.$on("afterDelete",this.deleteNum)
  },
  beforeDestroy(){
    this.$bus.$off("afterDelete")
  }
};
</script>

